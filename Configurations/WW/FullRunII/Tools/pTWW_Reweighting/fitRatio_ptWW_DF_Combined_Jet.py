# -*- coding: utf-8 -*-
import ROOT
import argparse
import os
import shutil
import glob
import math
import array

# python fitRatio.py --jet 1j
ROOT.gROOT.SetBatch(True) 
ROOT.gStyle.SetOptStat(0);
if __name__ == '__main__':

    canvas = ROOT.TCanvas("c1","c1",50,50,800,600)
    canvas.cd()
    
    ptWW_bin = "pTWW"

    rfile2018 = ROOT.TFile.Open("../../Full2018_v9/inclusive/rootFile/plots_WW2018_v9_incl.root", "READ")   

    histo2018DY_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2018DATA_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2018WW_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2018WWnf_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2018ggWW_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2018ggWWnf_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2018WWewk_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2018Vg_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2018WZ_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2018ZZ_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2018VVV_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2018Higgs_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2018top_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2018Fake_em_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2018Fake_me_0j = rfile2018.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_me")    

    # subtract other processes than top
    histoDATA = histo2018DATA_0j.Clone("")
    histoDATA.Add(histo2018DY_0j, -1)
    #histoDATA.Add(histo2018WW_0j, -1)
    histoDATA.Add(histo2018WWnf_0j, -1)
    histoDATA.Add(histo2018ggWW_0j, -1)
    histoDATA.Add(histo2018ggWWnf_0j, -1)
    histoDATA.Add(histo2018WWewk_0j, -1)
    histoDATA.Add(histo2018Vg_0j, -1)
    histoDATA.Add(histo2018WZ_0j, -1)
    histoDATA.Add(histo2018ZZ_0j, -1)
    histoDATA.Add(histo2018VVV_0j, -1)
    histoDATA.Add(histo2018Higgs_0j, -1)
    histoDATA.Add(histo2018top_0j, -1)
    histoDATA.Add(histo2018Fake_em_0j, -1)
    histoDATA.Add(histo2018Fake_me_0j, -1)

    histo_qqWW = histo2018WW_0j.Clone("qqWW MC")
    #histo_qqWW.Add(histo2018WWnf_0j)

    histo2018DY_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2018DATA_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2018WW_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2018WWnf_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2018ggWW_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2018ggWWnf_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2018WWewk_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2018Vg_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2018WZ_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2018ZZ_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2018VVV_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2018Higgs_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2018top_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2018Fake_em_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2018Fake_me_1j = rfile2018.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2018DATA_1j)
    histoDATA.Add(histo2018DY_1j, -1)
    #histoDATA.Add(histo2018WW_1j, -1)
    histoDATA.Add(histo2018WWnf_1j, -1)
    histoDATA.Add(histo2018ggWW_1j, -1)
    histoDATA.Add(histo2018ggWWnf_1j, -1)
    histoDATA.Add(histo2018WWewk_1j, -1)
    histoDATA.Add(histo2018Vg_1j, -1)
    histoDATA.Add(histo2018WZ_1j, -1)
    histoDATA.Add(histo2018ZZ_1j, -1)
    histoDATA.Add(histo2018VVV_1j, -1)
    histoDATA.Add(histo2018Higgs_1j, -1)
    histoDATA.Add(histo2018top_1j, -1)
    histoDATA.Add(histo2018Fake_em_1j, -1)
    histoDATA.Add(histo2018Fake_me_1j, -1)

    histo_qqWW.Add(histo2018WW_1j)
    #histo_qqWW.Add(histo2018WWnf_1j)

    histo2018DY_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2018DATA_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2018WW_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2018WWnf_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2018ggWW_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2018ggWWnf_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2018WWewk_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2018Vg_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2018WZ_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2018ZZ_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2018VVV_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2018Higgs_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2018top_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2018Fake_em_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2018Fake_me_2j = rfile2018.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2018DATA_2j)
    histoDATA.Add(histo2018DY_2j, -1)
    #histoDATA.Add(histo2018WW_2j, -1)
    histoDATA.Add(histo2018WWnf_2j, -1)
    histoDATA.Add(histo2018ggWW_2j, -1)
    histoDATA.Add(histo2018ggWWnf_2j, -1)
    histoDATA.Add(histo2018WWewk_2j, -1)
    histoDATA.Add(histo2018Vg_2j, -1)
    histoDATA.Add(histo2018WZ_2j, -1)
    histoDATA.Add(histo2018ZZ_2j, -1)
    histoDATA.Add(histo2018VVV_2j, -1)
    histoDATA.Add(histo2018Higgs_2j, -1)
    histoDATA.Add(histo2018top_2j, -1)
    histoDATA.Add(histo2018Fake_em_2j, -1)
    histoDATA.Add(histo2018Fake_me_2j, -1)

    histo_qqWW.Add(histo2018WW_2j)
    #histo_qqWW.Add(histo2018WWnf_2j)

    # 2017
    rfile2017 = ROOT.TFile.Open("../../Full2017_v9/inclusive/rootFile/plots_WW2017_v9_incl.root", "READ")

    histo2017DY_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2017DATA_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2017WW_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2017WWnf_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2017ggWW_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2017ggWWnf_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2017WWewk_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2017Vg_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2017WZ_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2017ZZ_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2017VVV_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2017Higgs_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2017top_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2017Fake_em_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2017Fake_me_0j = rfile2017.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2017DATA_0j)
    histoDATA.Add(histo2017DY_0j, -1)
    #histoDATA.Add(histo2017WW_0j, -1)
    histoDATA.Add(histo2017WWnf_0j, -1)
    histoDATA.Add(histo2017ggWW_0j, -1)
    histoDATA.Add(histo2017ggWWnf_0j, -1)
    histoDATA.Add(histo2017WWewk_0j, -1)
    histoDATA.Add(histo2017Vg_0j, -1)
    histoDATA.Add(histo2017WZ_0j, -1)
    histoDATA.Add(histo2017ZZ_0j, -1)
    histoDATA.Add(histo2017VVV_0j, -1)
    histoDATA.Add(histo2017Higgs_0j, -1)
    histoDATA.Add(histo2017top_0j, -1)
    histoDATA.Add(histo2017Fake_em_0j, -1)
    histoDATA.Add(histo2017Fake_me_0j, -1)

    histo_qqWW.Add(histo2017WW_0j)
    #histo_qqWW.Add(histo2017WWnf_0j)

    histo2017DY_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2017DATA_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2017WW_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2017WWnf_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2017ggWW_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2017ggWWnf_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2017WWewk_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2017Vg_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2017WZ_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2017ZZ_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2017VVV_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2017Higgs_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2017top_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2017Fake_em_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2017Fake_me_1j = rfile2017.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2017DATA_1j)
    histoDATA.Add(histo2017DY_1j, -1)
    #histoDATA.Add(histo2017WW_1j, -1)
    histoDATA.Add(histo2017WWnf_1j, -1)
    histoDATA.Add(histo2017ggWW_1j, -1)
    histoDATA.Add(histo2017ggWWnf_1j, -1)
    histoDATA.Add(histo2017WWewk_1j, -1)
    histoDATA.Add(histo2017Vg_1j, -1)
    histoDATA.Add(histo2017WZ_1j, -1)
    histoDATA.Add(histo2017ZZ_1j, -1)
    histoDATA.Add(histo2017VVV_1j, -1)
    histoDATA.Add(histo2017Higgs_1j, -1)
    histoDATA.Add(histo2017top_1j, -1)
    histoDATA.Add(histo2017Fake_em_1j, -1)
    histoDATA.Add(histo2017Fake_me_1j, -1)

    histo_qqWW.Add(histo2017WW_1j)
    #histo_qqWW.Add(histo2017WWnf_1j)

    histo2017DY_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2017DATA_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2017WW_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2017WWnf_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2017ggWW_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2017ggWWnf_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2017WWewk_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2017Vg_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2017WZ_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2017ZZ_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2017VVV_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2017Higgs_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2017top_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2017Fake_em_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2017Fake_me_2j = rfile2017.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2017DATA_2j)
    histoDATA.Add(histo2017DY_2j, -1)
    #histoDATA.Add(histo2017WW_2j, -1)
    histoDATA.Add(histo2017WWnf_2j, -1)
    histoDATA.Add(histo2017ggWW_2j, -1)
    histoDATA.Add(histo2017ggWWnf_2j, -1)
    histoDATA.Add(histo2017WWewk_2j, -1)
    histoDATA.Add(histo2017Vg_2j, -1)
    histoDATA.Add(histo2017WZ_2j, -1)
    histoDATA.Add(histo2017ZZ_2j, -1)
    histoDATA.Add(histo2017VVV_2j, -1)
    histoDATA.Add(histo2017Higgs_2j, -1)
    histoDATA.Add(histo2017top_2j, -1)
    histoDATA.Add(histo2017Fake_em_2j, -1)
    histoDATA.Add(histo2017Fake_me_2j, -1)

    histo_qqWW.Add(histo2017WW_2j)
    #histo_qqWW.Add(histo2017WWnf_2j)

	# 2016 HIPM
    rfile2016HIPM = ROOT.TFile.Open("../../Full2016_HIPM_v9/inclusive/rootFile/plots_WW2016_HIPM_v9_incl.root", "READ")

    histo2016HIPMDY_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016HIPMDATA_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016HIPMWW_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016HIPMWWnf_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016HIPMggWW_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016HIPMggWWnf_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016HIPMWWewk_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016HIPMVg_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016HIPMWZ_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016HIPMZZ_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016HIPMVVV_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016HIPMHiggs_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016HIPMtop_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016HIPMFake_em_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016HIPMFake_me_0j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016HIPMDATA_0j)
    histoDATA.Add(histo2016HIPMDY_0j, -1)
    #histoDATA.Add(histo2016HIPMWW_0j, -1)
    histoDATA.Add(histo2016HIPMWWnf_0j, -1)
    histoDATA.Add(histo2016HIPMggWW_0j, -1)
    histoDATA.Add(histo2016HIPMggWWnf_0j, -1)
    histoDATA.Add(histo2016HIPMWWewk_0j, -1)
    histoDATA.Add(histo2016HIPMVg_0j, -1)
    histoDATA.Add(histo2016HIPMWZ_0j, -1)
    histoDATA.Add(histo2016HIPMZZ_0j, -1)
    histoDATA.Add(histo2016HIPMVVV_0j, -1)
    histoDATA.Add(histo2016HIPMHiggs_0j, -1)
    histoDATA.Add(histo2016HIPMtop_0j, -1)
    histoDATA.Add(histo2016HIPMFake_em_0j, -1)
    histoDATA.Add(histo2016HIPMFake_me_0j, -1)

    histo_qqWW.Add(histo2016HIPMWW_0j)
    #histo_qqWW.Add(histo2016HIPMWWnf_0j)

    histo2016HIPMDY_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016HIPMDATA_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016HIPMWW_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016HIPMWWnf_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016HIPMggWW_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016HIPMggWWnf_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016HIPMWWewk_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016HIPMVg_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016HIPMWZ_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016HIPMZZ_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016HIPMVVV_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016HIPMHiggs_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016HIPMtop_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016HIPMFake_em_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016HIPMFake_me_1j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016HIPMDATA_1j)
    histoDATA.Add(histo2016HIPMDY_1j, -1)
    #histoDATA.Add(histo2016HIPMWW_1j, -1)
    histoDATA.Add(histo2016HIPMWWnf_1j, -1)
    histoDATA.Add(histo2016HIPMggWW_1j, -1)
    histoDATA.Add(histo2016HIPMggWWnf_1j, -1)
    histoDATA.Add(histo2016HIPMWWewk_1j, -1)
    histoDATA.Add(histo2016HIPMVg_1j, -1)
    histoDATA.Add(histo2016HIPMWZ_1j, -1)
    histoDATA.Add(histo2016HIPMZZ_1j, -1)
    histoDATA.Add(histo2016HIPMVVV_1j, -1)
    histoDATA.Add(histo2016HIPMHiggs_1j, -1)
    histoDATA.Add(histo2016HIPMtop_1j, -1)
    histoDATA.Add(histo2016HIPMFake_em_1j, -1)
    histoDATA.Add(histo2016HIPMFake_me_1j, -1)

    histo_qqWW.Add(histo2016HIPMWW_1j)
    #histo_qqWW.Add(histo2016HIPMWWnf_1j)

    histo2016HIPMDY_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016HIPMDATA_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016HIPMWW_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016HIPMWWnf_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016HIPMggWW_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016HIPMggWWnf_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016HIPMWWewk_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016HIPMVg_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016HIPMWZ_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016HIPMZZ_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016HIPMVVV_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016HIPMHiggs_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016HIPMtop_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016HIPMFake_em_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016HIPMFake_me_2j = rfile2016HIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016HIPMDATA_2j)
    histoDATA.Add(histo2016HIPMDY_2j, -1)
    #histoDATA.Add(histo2016HIPMWW_2j, -1)
    histoDATA.Add(histo2016HIPMWWnf_2j, -1)
    histoDATA.Add(histo2016HIPMggWW_2j, -1)
    histoDATA.Add(histo2016HIPMggWWnf_2j, -1)
    histoDATA.Add(histo2016HIPMWWewk_2j, -1)
    histoDATA.Add(histo2016HIPMVg_2j, -1)
    histoDATA.Add(histo2016HIPMWZ_2j, -1)
    histoDATA.Add(histo2016HIPMZZ_2j, -1)
    histoDATA.Add(histo2016HIPMVVV_2j, -1)
    histoDATA.Add(histo2016HIPMHiggs_2j, -1)
    histoDATA.Add(histo2016HIPMtop_2j, -1)
    histoDATA.Add(histo2016HIPMFake_em_2j, -1)
    histoDATA.Add(histo2016HIPMFake_me_2j, -1)

    histo_qqWW.Add(histo2016HIPMWW_2j)
    #histo_qqWW.Add(histo2016HIPMWWnf_2j)

    # 2016 noHIPM
    rfile2016noHIPM = ROOT.TFile.Open("../../Full2016_noHIPM_v9/inclusive/rootFile/plots_WW2016_noHIPM_v9_incl.root", "READ")

    histo2016noHIPMDY_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016noHIPMDATA_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016noHIPMWW_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016noHIPMWWnf_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016noHIPMggWW_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016noHIPMggWWnf_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016noHIPMWWewk_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016noHIPMVg_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016noHIPMWZ_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016noHIPMZZ_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016noHIPMVVV_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016noHIPMHiggs_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016noHIPMtop_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016noHIPMFake_em_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016noHIPMFake_me_0j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "0j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016noHIPMDATA_0j)
    histoDATA.Add(histo2016noHIPMDY_0j, -1)
    #histoDATA.Add(histo2016noHIPMWW_0j, -1)
    histoDATA.Add(histo2016noHIPMWWnf_0j, -1)
    histoDATA.Add(histo2016noHIPMggWW_0j, -1)
    histoDATA.Add(histo2016noHIPMggWWnf_0j, -1)
    histoDATA.Add(histo2016noHIPMWWewk_0j, -1)
    histoDATA.Add(histo2016noHIPMVg_0j, -1)
    histoDATA.Add(histo2016noHIPMWZ_0j, -1)
    histoDATA.Add(histo2016noHIPMZZ_0j, -1)
    histoDATA.Add(histo2016noHIPMVVV_0j, -1)
    histoDATA.Add(histo2016noHIPMHiggs_0j, -1)
    histoDATA.Add(histo2016noHIPMtop_0j, -1)
    histoDATA.Add(histo2016noHIPMFake_em_0j, -1)
    histoDATA.Add(histo2016noHIPMFake_me_0j, -1)

    histo_qqWW.Add(histo2016noHIPMWW_0j)
    #histo_qqWW.Add(histo2016noHIPMWWnf_0j)

    histo2016noHIPMDY_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016noHIPMDATA_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016noHIPMWW_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016noHIPMWWnf_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016noHIPMggWW_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016noHIPMggWWnf_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016noHIPMWWewk_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016noHIPMVg_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016noHIPMWZ_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016noHIPMZZ_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016noHIPMVVV_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016noHIPMHiggs_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016noHIPMtop_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016noHIPMFake_em_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016noHIPMFake_me_1j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "1j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016noHIPMDATA_1j)
    histoDATA.Add(histo2016noHIPMDY_1j, -1)
    #histoDATA.Add(histo2016noHIPMWW_1j, -1)
    histoDATA.Add(histo2016noHIPMWWnf_1j, -1)
    histoDATA.Add(histo2016noHIPMggWW_1j, -1)
    histoDATA.Add(histo2016noHIPMggWWnf_1j, -1)
    histoDATA.Add(histo2016noHIPMWWewk_1j, -1)
    histoDATA.Add(histo2016noHIPMVg_1j, -1)
    histoDATA.Add(histo2016noHIPMWZ_1j, -1)
    histoDATA.Add(histo2016noHIPMZZ_1j, -1)
    histoDATA.Add(histo2016noHIPMVVV_1j, -1)
    histoDATA.Add(histo2016noHIPMHiggs_1j, -1)
    histoDATA.Add(histo2016noHIPMtop_1j, -1)
    histoDATA.Add(histo2016noHIPMFake_em_1j, -1)
    histoDATA.Add(histo2016noHIPMFake_me_1j, -1)

    histo_qqWW.Add(histo2016noHIPMWW_1j)
    #histo_qqWW.Add(histo2016noHIPMWWnf_1j)

    histo2016noHIPMDY_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DY")
    histo2016noHIPMDATA_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_DATA")
    histo2016noHIPMWW_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_B0")
    histo2016noHIPMWWnf_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WW_nonfid")
    histo2016noHIPMggWW_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_B0")
    histo2016noHIPMggWWnf_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ggWW_nonfid")
    histo2016noHIPMWWewk_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WWewk")
    histo2016noHIPMVg_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Vg")
    histo2016noHIPMWZ_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_WZ")
    histo2016noHIPMZZ_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_ZZ")
    histo2016noHIPMVVV_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_VVV")
    histo2016noHIPMHiggs_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Higgs")
    histo2016noHIPMtop_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_top")
    histo2016noHIPMFake_em_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_em")
    histo2016noHIPMFake_me_2j = rfile2016noHIPM.Get("ww2l2v_13TeV_sr_" + "2j" + "_B0/" + ptWW_bin + "/histo_Fake_me")

    # subtract other processes than top
    histoDATA.Add(histo2016noHIPMDATA_2j)
    histoDATA.Add(histo2016noHIPMDY_2j, -1)
    #histoDATA.Add(histo2016noHIPMWW_2j, -1)
    histoDATA.Add(histo2016noHIPMWWnf_2j, -1)
    histoDATA.Add(histo2016noHIPMggWW_2j, -1)
    histoDATA.Add(histo2016noHIPMggWWnf_2j, -1)
    histoDATA.Add(histo2016noHIPMWWewk_2j, -1)
    histoDATA.Add(histo2016noHIPMVg_2j, -1)
    histoDATA.Add(histo2016noHIPMWZ_2j, -1)
    histoDATA.Add(histo2016noHIPMZZ_2j, -1)
    histoDATA.Add(histo2016noHIPMVVV_2j, -1)
    histoDATA.Add(histo2016noHIPMHiggs_2j, -1)
    histoDATA.Add(histo2016noHIPMtop_2j, -1)
    histoDATA.Add(histo2016noHIPMFake_em_2j, -1)
    histoDATA.Add(histo2016noHIPMFake_me_2j, -1)

    histo_qqWW.Add(histo2016noHIPMWW_2j)
    #histo_qqWW.Add(histo2016noHIPMWWnf_2j)

    # merge bins
    new_binning = array.array('d', [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200])
    #new_binning = array.array('d', [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 170, 200])
    histoDATA_rebinned = histoDATA.Rebin(len(new_binning) - 1,"histoDATA_rebinned",new_binning)
    histo_qqWW_rebinned = histo_qqWW.Rebin(len(new_binning) - 1,"histo_qqWW_rebinned",new_binning)
    
    print("New number of bins:", histoDATA_rebinned.GetNbinsX())
    print("Bin edges:")
    for i in range(1, histoDATA_rebinned.GetNbinsX() + 2):
        print(histoDATA_rebinned.GetBinLowEdge(i))
   
    # normalize to 1.
    histoDATA_rebinned.Scale(1./histoDATA_rebinned.Integral())  # DATA - all MC
    histo_qqWW_rebinned.Scale(1./histo_qqWW_rebinned.Integral())  # qqWW MC
    
    # Set axis titles with proper formatting
    histoDATA_rebinned.GetXaxis().SetTitle("p_{T}^{WW} (GeV)")
    histoDATA_rebinned.GetYaxis().SetTitle("")
    histoDATA_rebinned.GetXaxis().SetTitleSize(0.04)
    histoDATA_rebinned.GetYaxis().SetTitleSize(0.04)
    histoDATA_rebinned.GetXaxis().SetTitleOffset(1.2)
    histoDATA_rebinned.GetYaxis().SetTitleOffset(1.2)
    histoDATA_rebinned.SetStats(0)

    histoDATA_rebinned.SetMarkerStyle(20)
    histoDATA_rebinned.SetLineColor(ROOT.kBlack)
    histoDATA_rebinned.SetLineWidth(3)
    histoDATA_rebinned.SetLineColor(ROOT.kBlack)

    histoDATA_rebinned.SetMaximum(2)
    histoDATA_rebinned.SetMinimum(1e-6)		

    histoDATA_rebinned.Divide(histo_qqWW_rebinned)

    # Update axis titles for the ratio plot with proper formatting
    histo_qqWW_rebinned.GetXaxis().SetTitle("p_{T}^{WW} (GeV)")
    histo_qqWW_rebinned.GetYaxis().SetTitle("(Data - all other processes)/qqWW")
    histo_qqWW_rebinned.GetXaxis().SetTitleSize(0.04)
    histo_qqWW_rebinned.GetYaxis().SetTitleSize(0.04)
    histo_qqWW_rebinned.GetXaxis().SetTitleOffset(1.2)
    histo_qqWW_rebinned.GetYaxis().SetTitleOffset(1.2)

    #    tf1 = ROOT.TF1("tf1","pol11",30,700) # 1j
    # Create a list to store fit results
    fit_results = []

    # Perform fits and store results
    for order in range(1,5):
        tf = ROOT.TF1("tf%d" % order, "pol%d" % order, 0, 200)
        fit_result = histoDATA_rebinned.Fit("tf%d" % order, "S", "", 0, 200)
        chi2 = fit_result.Chi2()
        ndf = fit_result.Ndf()
        chi2_ndf = chi2/ndf if ndf > 0 else float('inf')
        fit_results.append((order, chi2_ndf, tf))
        print "Polynomial order %d: Chi2/NDF = %.3f" % (order, chi2_ndf)

    # Find best fit (lowest chi2/ndf)
    best_fit = min(fit_results, key=lambda x: x[1])
    print "\nBest fit: Polynomial order %d with Chi2/NDF = %.3f" % (best_fit[0], best_fit[1])

    # Draw histogram
    histoDATA_rebinned.Draw()

    # Create legend
    legend = ROOT.TLegend(0.7, 0.7, 0.9, 0.9)
    legend.SetHeader("Polynomial Order")
    # Draw only the fits we want (orders 6,7,8)
    colors = [ROOT.kRed, ROOT.kGreen, ROOT.kBlue, ROOT.kOrange,ROOT.kViolet, ROOT.kYellow, ROOT.kCyan, ROOT.kMagenta, ROOT.kSpring, ROOT.kPink]

    for i, (order, chi2_ndf, tf) in enumerate(fit_results):
        tf.SetLineColor(colors[i])
        tf.Draw("same")
        legend.AddEntry(tf, "pol%d (chi2/NDF=%.2f)" % (order, chi2_ndf), "l")
    legend.Draw()

    # Save results to file
    with open('ratio_plots/fit_results.txt', 'w') as f:
        f.write("Polynomial Order\tChi2/NDF\n")
        for order, chi2_ndf, _ in fit_results:
            f.write("%d\t%.3f\n" % (order, chi2_ndf))

    canvas.SaveAs('ratio_plots/ratio.png')
    canvas.SaveAs('ratio_plots/ratio.C')

    rfile2018.Close()
    rfile2017.Close()
    rfile2016HIPM.Close()
    rfile2016noHIPM.Close()
